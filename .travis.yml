# travis-ci.org supports D, using dub with various compilers
language: d

sudo: required
dist: trusty

d:
  - dmd-2.071.1
#  - dmd-2.069.2
  - ldc-1.1.0-beta2
#  - ldc-1.0.0
#  - gdc

before_install:
  - "if [ ${TRAVIS_OS_NAME} = 'osx' ]; then brew update; fi"
  - "if [ ${TRAVIS_OS_NAME} = 'osx' ]; then brew install libev libevent sqlite && brew link --force sqlite; fi"

install:
  - npm install -g bower

# removed test coverage until can get 'dub test -b unittest-cov --compiler=${DC}' working
#install:
#  - wget -O doveralls "https://github.com/ColdenCullen/doveralls/releases/download/v1.1.5/doveralls_linux_travis"
#  - chmod +x doveralls

os:
  - linux
  - osx

script:
  - dub test --compiler=${DC}

addons:
  apt:
    packages: [ libev-dev, libevent-dev, libsqlite3-dev ]

matrix:
  include:
    - env: NAME="Test Coverage - coveralls.io"
      d: dmd
      os: linux
      before_install: dub fetch doveralls
      script: dub test -b unittest-cov --compiler=${DC}
      after_success: dub run doveralls
  allow_failures:
    - d: gdc
    - env: NAME="Test Coverage - coveralls.io"
